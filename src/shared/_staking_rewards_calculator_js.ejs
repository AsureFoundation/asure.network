<script src="http://afarkas.github.io/webshim/js-webshim/minified/polyfiller.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script>

    $(function () {
        $('[data-toggle="popover"]').popover()
    });

    $("input").keyup(rewards);
    $("input").change(rewards);

    init();

    function init() {
        $("#ownTokensStaking").val(1);
        $("#totalTokensStaked").val(50000000);
        $("#dalilyTransactionVolume").val(100000000);
        $("#avgTransactionSize").val(40);

        $("#baseFlatFee").val(0.05);
        $("#percentageFee").val(0.25);

        $("#avgFeesPaidDay").val(375000);
        $("#avgTransactionDay").val(2500000);
        rewards();
    }

    function strToNumber(e) {
        return e ? Number(e.replace(/[^0-9\.\-]/g, "")) : 0
    }

    function rewards() {

        var ownTokensStaking = strToNumber($("#ownTokensStaking").val());
        var totalTokensStaked = strToNumber($("#totalTokensStaked").val());

        var baseFlatFee = strToNumber($("#baseFlatFee").val());
        var percentageFee = strToNumber($("#percentageFee").val());
        var dalilyTransactionVolume = strToNumber($("#dalilyTransactionVolume").val());
        var avgTransactionSize = strToNumber($("#avgTransactionSize").val());

        var dailyTx = dalilyTransactionVolume / avgTransactionSize;
        var flatFee = dailyTx * baseFlatFee;
        var percentageFeeCalc = dalilyTransactionVolume * percentageFee / 100;

        var e = (flatFee + percentageFeeCalc) / totalTokensStaked * ownTokensStaking;
        var daily = e;
        var monthly = 30 * e;
        var yearly = 365 * e;

        $("#avgTransactionDay").val(dailyTx);
        //TODO: Average fees paid per day

        $("#perDay").text("$ " + (Math.round(daily * 10000) / 10000) + "");
        $("#perMonth").text("$ " + (Math.round(monthly * 10000) / 10000) + "");
        $("#perYear").text("$ " + (Math.round(yearly * 100) / 100) + "");
    }

    function resetValues() {
        this.init();
    }

    if(webshims) {
        webshims.setOptions('forms-ext', {
            replaceUI: 'auto',
            types: 'number'
        });
        webshims.polyfill('forms forms-ext');
    }
</script>

<!--
            totalTokens: "50,000,000",
            volumeTx: "100,000,000",
            amountTx: "40",
            flatFee: "0.05",
            percentageFee: "0.25",
            nbTokens: "1"

                formValues: function() {
                    return {
                        totalTokens: this.strToNumber(this.form.totalTokens),
                        volumeTx: this.strToNumber(this.form.volumeTx),
                        amountTx: this.strToNumber(this.form.amountTx),
                        flatFee: this.strToNumber(this.form.flatFee),
                        percentageFee: this.strToNumber(this.form.percentageFee),
                        nbTokens: this.strToNumber(this.form.nbTokens)
                    }
                },,
                dailyTxDisplay: function() {
                    r) {
                    retureturn d()(this.dailyTx).format("0,0")
                },
                averageFeeDisplay: function(n "$" + d()(this.flatFee + this.percentageFee).format("0,0")
                },

-->


